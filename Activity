using System;
using System.Collections.Generic;

class Patient
{
    public string Name { get; set; }
    public List<int> SelectedServices { get; set; } = new List<int>();
    public Stack<int> ServiceStack { get; set; } = new Stack<int>();
    public double InsurancePercent { get; set; }
    public int InsuranceChoice { get; set; }
    public int AdmitDays { get; set; }
    public bool IsSenior { get; set; }
}

class PatientBilling
{
    static void Main()
    {
        Dictionary<int, (string Name, int Cost)> availableServices =
            new Dictionary<int, (string, int)>()
        {
            { 1, ("Lab Test", 600) },
            { 2, ("X-Ray", 300) },
            { 3, ("ECG", 1500) },
            { 4, ("MRI", 2500) },
            { 5, ("Ultrasound", 1200) },
            { 6, ("Blood Work", 400) }
        };

        int baseConsultationFee = 500;
        const int admitFeePerDay = 2000;

        string[] insuranceCoverages =
        {
            "Full Amount",
            "Optional Services (Tests/Scans) Only",
            "Admit Fee Only",
            "Consultation Fee Only"
        };

        Queue<Patient> patientQueue = new Queue<Patient>();
        Stack<Patient> patientStack = new Stack<Patient>();

        while (true)
        {
            Console.Write("\nEnter patient name (or 'done' to finish, 'undo' to remove last): ");
            string name = Console.ReadLine()?.Trim();

            if (string.IsNullOrWhiteSpace(name)) continue;
            if (name.ToLower() == "done") break;

            if (name.ToLower() == "undo")
            {
                if (patientStack.Count > 0)
                {
                    Patient removed = patientStack.Pop();
                    Queue<Patient> tempQueue = new Queue<Patient>();
                    while (patientQueue.Count > 0)
                    {
                        Patient p = patientQueue.Dequeue();
                        if (p != removed) tempQueue.Enqueue(p);
                    }
                    patientQueue = tempQueue;
                    Console.WriteLine($"Last patient entry undone: {removed.Name}");
                }
                else
                {
                    Console.WriteLine("No patient to undo.");
                }
                continue;
            }

            Console.WriteLine("\nAvailable Services:");
            foreach (var service in availableServices)
            {
                Console.WriteLine($"{service.Key}. {service.Value.Name} - {service.Value.Cost}");
            }

            List<int> selectedServices = new List<int>();
            Stack<int> serviceStack = new Stack<int>();

            Console.WriteLine("\nEnter the numbers of optional services used (comma-separated).");
            Console.WriteLine("Press Enter if none were used:");
            string servicesInput = Console.ReadLine();

            if (!string.IsNullOrWhiteSpace(servicesInput))
            {
                foreach (var s in servicesInput.Split(','))
                {
                    int serviceNumber;
                    while (true)
                    {
                        if (int.TryParse(s.Trim(), out serviceNumber) &&
                            availableServices.ContainsKey(serviceNumber))
                        {
                            selectedServices.Add(serviceNumber);
                            serviceStack.Push(serviceNumber);
                            break;
                        }
                        else
                        {
                            Console.Write($"Service number '{s.Trim()}' not recognized. Please enter a valid service number: ");
                            string retry = Console.ReadLine();
                            if (int.TryParse(retry.Trim(), out serviceNumber) &&
                                availableServices.ContainsKey(serviceNumber))
                            {
                                selectedServices.Add(serviceNumber);
                                serviceStack.Push(serviceNumber);
                                break;
                            }
                        }
                    }
                }
            }

            double insurancePercent;
            while (true)
            {
                Console.Write("Enter insurance coverage percentage (0–100): ");
                string insuranceInput = Console.ReadLine();
                if (double.TryParse(insuranceInput, out insurancePercent) &&
                    insurancePercent >= 0 && insurancePercent <= 100)
                {
                    break;
                }
                Console.WriteLine("Invalid input. Please enter a number between 0 and 100.");
            }

            int insuranceChoice;
            while (true)
            {
                Console.WriteLine("\nWhat does the insurance cover?");
                for (int i = 0; i < insuranceCoverages.Length; i++)
                {
                    Console.WriteLine($"{i + 1}. {insuranceCoverages[i]}");
                }
                Console.Write("Enter your choice (1–4): ");
                string insuranceChoiceInput = Console.ReadLine();
                if (int.TryParse(insuranceChoiceInput, out insuranceChoice) &&
                    insuranceChoice >= 1 && insuranceChoice <= insuranceCoverages.Length)
                {
                    break;
Billing
{
    static void Main()
    {
        Dictionary<int, (string Name, int Cost)> availableServices =
            new Dictionary<int, (string, int)>()
        {
            { 1, ("Lab Test", 600) },
            { 2, ("X-Ray", 300) },
            { 3, ("ECG", 1500) },
            { 4, ("MRI", 2500) },
            { 5, ("Ultrasound", 1200) },
            { 6, ("Blood Work", 400) }
        };

        int baseConsultationFee = 500;

        Console.WriteLine("Available Services:");
        foreach (var service in availableServices)
        {
            Console.WriteLine($"{service.Key}. {service.Value.Name} - {service.Value.Cost}");
        }

        Console.WriteLine("\nEnter the numbers of optional services used (comma-separated).");
        Console.WriteLine("Press Enter if none were used:");
        string servicesInput = Console.ReadLine();

        List<string> selectedServiceNumbers = new List<string>();

        if (!string.IsNullOrWhiteSpace(servicesInput))
        {
            selectedServiceNumbers = new List<string>(servicesInput.Split(','));
        }

        Console.Write("Enter insurance coverage percentage (e.g., 20 for 20%): ");
        string insuranceInput = Console.ReadLine();

        double insurancePercent = 0;
        if (!double.TryParse(insuranceInput, out insurancePercent) ||
            insurancePercent < 0 || insurancePercent > 100)
        {
            Console.WriteLine("Invalid input. Setting insurance coverage to 0%.");
            insurancePercent = 0;
        }

        Console.WriteLine("\nWhat does the insurance cover?");
        Console.WriteLine("1. Full Amount");
        Console.WriteLine("2. Optional Services (Tests/Scans) Only");
        Console.WriteLine("3. Admit Fee Only");
        Console.WriteLine("4. Consultation Fee Only");
        Console.Write("Enter your choice: ");
        string insuranceChoiceInput = Console.ReadLine();

        int insuranceChoice = 1;
        int.TryParse(insuranceChoiceInput, out insuranceChoice);

        const int admitFeePerDay = 2000;

        Console.Write("Enter number of admit days (0 if not admitted): ");
        string admitInput = Console.ReadLine();

        int admitDays = 0;
        if (!int.TryParse(admitInput, out admitDays) || admitDays < 0)
        {
            Console.WriteLine("Invalid input. Setting admit days to 0.");
            admitDays = 0;
        }

        int optionalServicesAmount = 0;
        int totalAmount = baseConsultationFee;
        int discountAmount = 0;
        int insuranceAmount = 0;
        int finalAmount = 0;

        int admitAmount = admitDays * admitFeePerDay;

        foreach (string number in selectedServiceNumbers)
        {
            if (int.TryParse(number.Trim(), out int serviceNumber) &&
                availableServices.ContainsKey(serviceNumber))
            {
                optionalServicesAmount += availableServices[serviceNumber].Cost;
            }
            else
            {
                Console.WriteLine($"Service number '{number.Trim()}' not recognized. Skipping.");
            }
        }

        totalAmount += optionalServicesAmount + admitAmount;

        if (totalAmount > 2000)
        {
            discountAmount = (int)(totalAmount * 0.05);
        }

        int discountedAmount = totalAmount - discountAmount;

        // ✅ Senior citizen discount
        Console.Write("Is Patient a senior citizen (aged 60 or above)? (y/n): ");
        string seniorInput = Console.ReadLine()?.Trim().ToLower();

        int seniorDiscount = 0;

        if (seniorInput == "y")
        {
            seniorDiscount = (int)(discountedAmount * 0.10);
            Console.WriteLine("Senior citizen discount of 10% applied.");
        }

        int afterSenior = discountedAmount - seniorDiscount;

        // ✅ Track what insurance applies to
        string insuranceAppliedOn = "";

        // ✅ Apply insurance
        switch (insuranceChoice)
        {
            case 1:
                insuranceAmount = (int)(afterSenior * (insurancePercent / 100.0));
                insuranceAppliedOn = "Total Amount";
                break;

            case 2:
                insuranceAmount = (int)(optionalServicesAmount * (insurancePercent / 100.0));
                insuranceAppliedOn = "Optional Services";
                break;

            case 3:
                insuranceAmount = (int)(admitAmount * (insurancePercent / 100.0));
                insuranceAppliedOn = "Admit Fee";
                break;

            case 4:
                insuranceAmount = (int)(baseConsultationFee * (insurancePercent / 100.0));
                insuranceAppliedOn = "Consultation Fee";
                break;

            default:
                insuranceAmount = 0;
                insuranceAppliedOn = "None";
                break;
        }

        int afterInsurance = afterSenior - insuranceAmount;

        int taxAmount = (int)(afterInsurance * 0.08);

        finalAmount = afterInsurance + taxAmount;

        Console.WriteLine("\n--- Billing Summary ---");
        Console.WriteLine($"Bill Date & Time: {DateTime.Now:dd-MMM-yyyy hh:mm tt}");
        Console.WriteLine($"Consultation Fee: {baseConsultationFee}");
        Console.WriteLine($"Optional Services Total: {optionalServicesAmount}");
        Console.WriteLine($"Admit Fee ({admitDays} days @ {admitFeePerDay}/day): {admitAmount}");
        Console.WriteLine($"Total Amount (before discount): {totalAmount}");
        Console.WriteLine($"Discount Applied: {discountAmount}");
        Console.WriteLine($"Senior Citizen Discount (10%): {seniorDiscount}");
        Console.WriteLine($"Insurance Deduction ({insurancePercent}% of {insuranceAppliedOn}): {insuranceAmount}");
        Console.WriteLine($"Amount after Discount & Insurance: {afterInsurance}");
        Console.WriteLine($"Tax (8%): {taxAmount}");
        Console.WriteLine($"Final Amount Payable by Patient: {finalAmount}");
    }
}
